---
- name: Write SkyDNS pod file
  sudo: yes
  template:
    src: skydns-rc.yaml.j2
    dest: "{{ kube_manifest_dir }}/skydns-rc.yaml"
  register: dns_rc_def
  when: dns_setup
  tags:
    - skydns

- name: Write SkyDNS service file
  sudo: yes
  template:
    src: skydns-svc.yaml.j2
    dest: "{{ kube_manifest_dir }}/skydns-svc.yaml"
  register: dns_svc_def
  when: dns_setup
  tags:
    - skydns

- name: Create or update SkyDNS replication controller
  sudo: yes
  kube:
    namespace: kube-system
    resource: rc
    name: kube-dns-v8
    filename: "{{ kube_manifest_dir }}/skydns-rc.yaml"
    state: "{{ dns_rc_def.changed | ternary('latest','present') }}"
  when: dns_setup
  tags:
    - skydns

- name: Create or update SkyDNS service
  sudo: yes
  kube:
    namespace: kube-system
    resource: svc
    name: kube-dns
    filename: "{{ kube_manifest_dir }}/skydns-svc.yaml"
    state: "{{ dns_svc_def.changed | ternary('latest','present') }}"
  when: dns_setup
  tags:
    - skydns

